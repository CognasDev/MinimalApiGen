@page "/allmusic"
@attribute [StreamRendering]
@rendermode InteractiveServer
@using Samples.MusicCollection.Web.Models
@using Samples.MusicCollection.Web.AllMusic

<PageTitle>All Music</PageTitle>

<RadzenDataGrid @ref=ArtistsGrid
                Data="@AllMusicBusinessLogic.Artists" IsLoading="@ArtistsLoading" Count="@ArtistsCount" TItem="ArtistDetail"
                AllowSorting="true" AllowFiltering="true" AllowPaging="true" PageSize="10" PagerHorizontalAlign="HorizontalAlign.Center"
                RowExpand="ArtistsGrid_RowExpand" ExpandMode="DataGridExpandMode.Single">

    <HeaderTemplate>
        <RadzenButton ButtonStyle="ButtonStyle.Success" Icon="add_circle" Text="New Artist" Click="@NewAritstAsync" />
    </HeaderTemplate>

    @* Artist Columns *@
    <Columns>
        <RadzenDataGridColumn Property="@nameof(Artist.Name)" Width="*" Title="@nameof(Artist)" SortOrder="SortOrder.Ascending">
            <EditTemplate Context="ArtistDetail">
                <RadzenTextBox Name="ArtistNameTextBox" @bind-Value="ArtistDetail.Name" MaxLength="250" 
                               Style="width:200px; display: block" aria-label="Enter artist name" />
                <RadzenRequiredValidator Text="Artist name is required" Component="ArtistNameTextBox" Popup="true" />
            </EditTemplate>
        </RadzenDataGridColumn>
        <RadzenDataGridColumn Context="ArtistDetail" Filterable="false" Sortable="false" Width="100px" TextAlign="TextAlign.Right" Frozen="true" FrozenPosition="FrozenColumnPosition.Right">
            <EditTemplate Context="ArtistDetail">
                <RadzenButton Icon="check" ButtonStyle="ButtonStyle.Success" Variant="Variant.Flat" Size="ButtonSize.Medium" Click="@((args) => SaveArtistAsync(ArtistDetail))" aria-label="Save" />
            </EditTemplate>
        </RadzenDataGridColumn>
    </Columns>

    @* Artist Albums *@
    <Template Context="ArtistDetail">
        <RadzenDataGrid @ref=AlbumsGrid
                        Data="@ArtistDetail.Albums" IsLoading="@AlbumsLoading" Count="@AlbumsCount" TItem="AlbumDetail"
                        AllowFiltering="true" AllowPaging="true" AllowSorting="true"
                        RowExpand="AlbumsGrid_RowExpand" ExpandMode="DataGridExpandMode.Single">

            <HeaderTemplate>
                <RadzenButton ButtonStyle="ButtonStyle.Success" Icon="add_circle" Text="New Album" />
            </HeaderTemplate>

            @* Album Columns *@
            <Columns>
                <RadzenDataGridColumn Property="@nameof(Album.Name)" Width="300px" Title="@nameof(Album)" SortOrder="SortOrder.Ascending" />
                <RadzenDataGridColumn Property="@nameof(Album.LabelId)" Width="300px" Title="@nameof(Label)">
                    <Template Context="AlbumDetail">
                        <RadzenLabel Text="@AllMusicBusinessLogic.LabelName(@AlbumDetail.LabelId)" />
                    </Template>
                </RadzenDataGridColumn>
                <RadzenDataGridColumn Property="@nameof(Album.GenreId)" Width="300px" Title="@nameof(Genre)">
                    <Template Context="AlbumDetail">
                        <RadzenLabel Text="@AllMusicBusinessLogic.GenreName(@AlbumDetail.GenreId)" />
                    </Template>
                </RadzenDataGridColumn>
                <RadzenDataGridColumn Property="@nameof(Album.ReleaseDate)" Title="Release Date" FormatString="{0:dd MMM yyyy}" />
            </Columns>

            @* Album Tracks *@
            <Template Context="AlbumDetail">
                <RadzenDataGrid @ref=TracksGrid
                                Data="@AlbumDetail.Tracks" IsLoading="@TracksLoading" Count="@TracksCount"
                                AllowFiltering="true" AllowPaging="false" AllowSorting="true">

                    <HeaderTemplate>
                        <RadzenButton ButtonStyle="ButtonStyle.Success" Icon="add_circle" Text="New Track" />
                    </HeaderTemplate>

                    <Columns>
                        <RadzenDataGridColumn Property="@nameof(Track.TrackNumber)" Width="200px" Title="Track Number" SortOrder="SortOrder.Ascending" />
                        <RadzenDataGridColumn Property="@nameof(Track.Name)" Width="*" Title="@nameof(Track)" />
                        <RadzenDataGridColumn Property="@nameof(Track.GenreId)" Width="200px" Title="@nameof(Genre)">
                            <Template Context="TrackDetail">
                                <RadzenLabel Text="@AllMusicBusinessLogic.GenreName(@TrackDetail.GenreId)" />
                            </Template>
                            <EditTemplate Context="TrackDetail">
                                <RadzenDropDown TValue="Genre" Data="@AllMusicBusinessLogic.Genres"
                                                Value="@TrackDetail.GenreId"
                                                ValueProperty="@nameof(Genre.GenreId)"  TextProperty="@nameof(Genre.Name)" />
                            </EditTemplate>
                        </RadzenDataGridColumn>
                        <RadzenDataGridColumn Property="@nameof(Track.KeyId)" Width="200px" Title="@nameof(Key)">
                            <Template Context="TrackDetail">
                                <RadzenLabel Text="@AllMusicBusinessLogic.KeyNameAndCamelot(@TrackDetail.KeyId)" />
                            </Template>
                            <EditTemplate Context="TrackDetail">
                                <RadzenDropDown TValue="Key" Data="@AllMusicBusinessLogic.Keys"
                                                Value="@TrackDetail.KeyId"
                                                ValueProperty="@nameof(Key.KeyId)" TextProperty="@nameof(Key.Name)" />
                            </EditTemplate>
                        </RadzenDataGridColumn>
                        <RadzenDataGridColumn Property="@nameof(Track.Bpm)" Width="200px" Title="@nameof(Track.Bpm)" />
                    </Columns>
                </RadzenDataGrid>
            </Template>
        </RadzenDataGrid>
    </Template>

</RadzenDataGrid>